<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title></title>
    <meta charset="utf-8" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="my-theme.css" type="text/css" />
    <link rel="stylesheet" href="animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


name: title_slide
class: middle, title-slide, animated, fadeIn, faster

&lt;div class="my-footer"&gt;&lt;/div&gt;

.titleslide-title[(Data Cleaning + Fuzzy Matching) in R]

&lt;br&gt;
### .title-font[Data Cleaning Brown Bag]
####.title-font[Faculty of Information (iSchool) at University of Toronto]

&lt;br&gt;
### &lt;b&gt; .title-font[Eugene Joh] &lt;/b&gt;
.title-font[*February 28 2020*]
&lt;br&gt;

&lt;!-- &lt;h4&gt;&lt;i class="fab fa-github fa-lg"&gt;&amp;nbsp;&lt;/i&gt; &lt;i class="fab fa-twitter fa-lg"&gt;&lt;/i&gt; .title-font[[&amp;nbsp;@eugejoh](https://twitter.com/eugejoh)] --&gt;

&lt;div class = "my-footer"&gt;&lt;span&gt;Disclaimer: views and opinions expressed here are my own and do not represent my employer&lt;/div&gt;


???

---
name: intro
class: animated, fadeIn, faster

.pull-left[  
# Outline

  - Challenges with global health datasets
  - Geocoding locations in India using R  
    - Cleaning messy text  
    - Fuzzy matching  
    - Iteration  
  - Lessons learned  
]

.pull-right[
&lt;br&gt;
&lt;img src="https://cdn.onlinewebfonts.com/svg/img_385487.png" width="120" style="display: block; margin: auto;" /&gt;
&lt;br&gt;
&lt;img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/R_logo.svg/724px-R_logo.svg.png" width="150px" style="display: block; margin: auto;" /&gt;
&lt;br&gt;
&lt;img src="https://www.traillink.com/images/tl/custom-icons/new-map-icon.svg" width="200px" style="display: block; margin: auto;" /&gt;
]

???
Today I’ll be talking about some challenges that I’ve come to identify with commonly used global health datasets, then I’ll provide a walkthrough or case study on a project I was involved with this past summer where we had to geocode villages and towns in India. I’ll demonstrate about how I used R to tackle this project, breaking it down into 3 sections – I’ll be showing some code and examples of the steps involved.
And then I’ll finish with a couple lessons learned and takeways from this project, that I hope will be useful or at least interesting for those here today.


---
name: tweet
class: animated, fadeIn, faster

&lt;center&gt;
&lt;blockquote class="twitter-tweet" width="300" data-lang="en"&gt;&lt;p lang="en" dir="ltr"&gt;&lt;a href="https://twitter.com/causalinf/status/1230146663207096320"&gt;19, February 2020&lt;/a&gt;&lt;/blockquote&gt;
&lt;/center&gt;

???
Before I jump into it, I wanted to share this tweet I found hilarious and a bit sad – there’s a paper reporting that 20% of all genomic data out there has errors attributed to the feature Excel has that auto-converts strings into a date format, essentially changing the content of that cell.

I think this highlights the importance of data cleaning, and just an understanding that certain software we use regularly can throw in wrenches into the systems and workflows we have with data. I think events like this, that provide the space to share challenges and ideas like this brown bag are really great.

---
name: globalhealthtitle
class: title-slide, middle, animated, fadeIn, faster

# Challenges with Cleaning Global Health Data

???

---
name: ghdata
class: animated, fadeIn, faster

# Global Health

*"improving the health of populations at the international level"*

.pull-left[
  - Vital statistics  
    - Births, deaths, population composition  
- Health surveys  
    - Sample-based
    - Household-level information
    - E.g. malaria, HIV, maternal &amp; child health, malnutrition, etc.
]

.pull-right[
&lt;img src="https://2oqz471sa19h3vbwa53m33yj-wpengine.netdna-ssl.com/wp-content/uploads/2017/09/681viwphrfnz-1.gif" width="350" /&gt;
]


???
So just at a high-level global health is the study of population health, at the global or international level. A lot of this work is focused in lower-middle income countries, countries with less resources and infrastructure we take for granted in countries like here in Canada.

A lot of the data generated and used in the area of global health is related to activity of governments and international organizations (like the WHO, USAID) – they are usually built on existing census programs that capture information like birth rates, mortality, sex ratios, etc.

These surveys are usually sample-based or based on a sample design, they typically capture information down to the household-level, and focus on specific causes of disease burden, overall-health, and vulnerable groups


---
name: commonchallenges
class: animated, fadeIn, faster


# Common Data Challenges

.pull-left50[

- Data collection -&gt; entry errors  
- Missing/incomplete data  
- Lack of Metadata
- Ambiguity due to...
  - Alternative spelling 
  - Multiple languages
  ]
--

.pull-right50[



```r
# I know what this means
"doughnut"
"donut"

# Hmmm .. Google please help me
"Gothra" #a village?
"Gotra"  #a clan or lineage? maybe a village?

"Kaipukharia" #a village
"Kaipukuria"  #also a village, k
"Kaipukhuria" #and also a village..?
```

]

???

data collection, especially when using paper forms is problematic with data entry. also speaks to the training of those writing down names, 

---
name: geocodingtitle
class: title-slide, middle, animated, fadeIn, faster

# 

???

---
name: projectdescr
class: animated, fadeIn, faster

# Geocoding by Linking Datasets
**Objective**
 - Assign latitude/longitude to survey sampling units

**Data Sources**
 - Master list of sampling units
 - Village and town amenities
 - Pin code locations
 - Shapefiles of administrative divisions


???

---
name: probs
class: animated, fadeIn, faster

# Problem(s)

Join on village/town name
 - Messy and inconsistent text
 - Alternative spelling of village/town names
 - Duplicated records
   - Multiple sampling units  single location name
   - Single location name  multiple lat/lon

**No foreign key for consistent joins**


---
name: precedent
class: animated, fadeIn, faster

.pull-left[

# What Precedent Existed?

**SQL queries:**
 - Standardize text (e.g. letter case)
 - Basic text cleaning (e.g. removing spaces)
 - Join datasets on “cleaned” village/town names
 - Nearest-distance measurements

]

.pull-right[
&lt;br&gt;
&lt;img src="https://wiki.postgresql.org/images/thumb/a/a4/PostgreSQL_logo.3colors.svg/540px-PostgreSQL_logo.3colors.svg.png" width="250" style="display: block; margin: auto;" /&gt;
&lt;br&gt;
&lt;img src="https://www.osgeo.org/wp-content/uploads/postgis-logo-171x250.png" width="200" style="display: block; margin: auto;" /&gt;

]

---
name: rtoolkit
class: animated, fadeIn, faster

.pull-left[
# Toolkit in R

 - Cleaning, Processing, and Joins
    - `dplyr`
    - `stringr`
    - `purrr`
 - Fuzzy Matching
    - `stringdist`
 - Database Connections
    - `DBI`
    - `RPostgres`
    - `dbplyr`

]

.pull-right[

&lt;img src="img/dplyr.svg" width="140" style="display: block; margin: auto;" /&gt;&lt;img src="img/stringr.svg" width="140" style="display: block; margin: auto;" /&gt;&lt;img src="img/purrr.svg" width="140" style="display: block; margin: auto;" /&gt;

]

???


---
name: cleantext
class: animated, fadeIn, faster

# Cleaning Text

Dplyr, stringr
Targeted cleaning of data frames
Case standardization
Remove white space
Remove symbols
Regular expression


---
name: fuzzmatch
class: animated, fadeIn, faster

# Fuzzy Matching
What is it? What is string distance?
Example of stringdist in R
Joining on variables


---
name: purrr
class: animated, fadeIn, faster

# Iteration

Purrr
Iterate across “blocks” 
multiple matches, administrative boundaries,


---
name: useexist
class: animated, fadeIn, faster

# Leverage Existing Solutions
DBI, dbplyr, RPostgres
Run SQL scripts for nearest-distance measurement
Destination of tables were in PostgreSQL

---
name: results
class: animated, fadeIn, faster

# Results
Just cleaning strings increased overall match rate by
Fuzzy matching improved overall match rate by … and reduced manual review by …
Iterating SQL scripts increased efficiency and reproducibility
Reduced leftover manual matching

---
name: takeaway
class: animated, fadeIn, faster

# Lessons Learned

Identify the problems
Identify the potential tools
Leverage existing solutions
Understand


---
name: lastslide

thanks
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": false,
"ratio": "16:9",
"countIncrementalSlides": true,
"slideNumberFormat": "%current%/%total%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
